generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ########################################
// ##                                    ##
// ##               User                 ##
// ##                                    ##
// ########################################
model User {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  admin Boolean @default(false)

  first_name String
  last_name  String
  email      String @unique
  password   String

  personal_id String @unique
  sex         Sex

  has_profile         Profile?        @relation("profile_of_user")
  has_mate_preference Profile?        @relation("mate_pref_of_user")
  has_dorm_preference DormPreference?

  roomId   String?
  lived_in Room?   @relation("lived_in", fields: [roomId], references: [id])
}

// ########################################
// ##                                    ##
// ##        Profile & Mate Pref         ##
// ##                                    ##
// ########################################
model Profile {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  owner_id       String @unique
  belong_to_user User?  @relation("profile_of_user", fields: [owner_id], references: [id])
  pref_owner_id  String @unique
  preference_of  User?  @relation("mate_pref_of_user", fields: [pref_owner_id], references: [id])

  talkative YesNoPrefer
  snore     YesNoPrefer
  // loud_player YesNoPrefer

  // scale attribute 
  messiness           Int
  loudness_resistance Int
  night_life          Int

  // range attribute
  sleep_lo DateTime
  sleep_hi DateTime

  game_lo DateTime
  game_hi DateTime

  nap_lo DateTime
  nap_hi DateTime

  party_lo DateTime
  party_hi DateTime
}

// ########################################
// ##                                    ##
// ##             Dorm Pref              ##
// ##                                    ##
// ########################################
model DormPreference {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  owner_id       String @unique
  belong_to_user User   @relation(fields: [owner_id], references: [id])

  has_canteen      YesNoPrefer
  has_minimart     YesNoPrefer
  has_laundry      YesNoPrefer
  close_to_transit YesNoPrefer
  dorm_type        DormTypePrefer

  room_pref_id          String         @unique
  about_room_preference RoomPreference @relation("belong_to_dorm_preference", fields: [room_pref_id], references: [id])
  userId                String
}

// ########################################
// ##                                    ##
// ##             Room Pref              ##
// ##                                    ##
// ########################################
model RoomPreference {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  belong_to_dorm_preference DormPreference? @relation("belong_to_dorm_preference")

  zone            Zone
  floor_number    Int
  residents_limit Int

  close_to_computer_room YesNoPrefer
  close_to_shower_room   YesNoPrefer
  close_to_stair         YesNoPrefer
}

// ########################################
// ##                                    ##
// ##                Dorm                ##
// ##                                    ##
// ########################################
model Dorm {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  name      String
  sex       Sex
  dorm_type DormType

  has_canteen      YesNo
  has_minimart     YesNo
  has_laundry      YesNo
  close_to_transit YesNo

  floors Floor[] @relation("belong_to_dorm")
}

// ########################################
// ##                                    ##
// ##               Floor                ##
// ##                                    ##
// ########################################
model Floor {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  dormId         String
  belong_to_dorm Dorm   @relation("belong_to_dorm", fields: [dormId], references: [id])

  floor_number      Int
  has_computer_room YesNo

  rooms Room[]
}

// ########################################
// ##                                    ##
// ##                Room                ##
// ##                                    ##
// ########################################
model Room {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  floorId         String?
  belong_to_floor Floor?  @relation(fields: [floorId], references: [id])

  room_number    Int
  resident_limit Int
  zone           Zone

  close_to_shower_room YesNo
  close_to_stair       YesNo

  residents User[] @relation("lived_in")
}

// ########################################
// ##                                    ##
// ##                Enum                ##
// ##                                    ##
// ########################################
enum DormType {
  BUFFET
  PREMIUM_BUFFET
  MONTHLY
}

enum DormTypePrefer {
  BUFFET
  PREMIUM_BUFFET
  MONTHLY
  IGNORE
}

enum YesNo {
  YES
  NO
}

enum YesNoPrefer {
  YES
  NO
  IGNORE
}

enum Zone {
  DESERT
  JUNGLE
}

enum Sex {
  MALE
  FEMALE
}
